#!/bin/bash

LANG_FILE=".commit-lang"
COMMIT_MSG_FILE=$1
RAW_MSG=$(head -n1 "$COMMIT_MSG_FILE")

# Ignora commits autom√°ticos como merge, revert ou fixup
if echo "$RAW_MSG" | grep -Eq '^(merge|revert|fixup|squash)'; then
  exit 0
fi

# Verifica se existe o arquivo de configura√ß√£o
if [ ! -f "$LANG_FILE" ]; then
  echo "‚ùå Arquivo .commit-lang n√£o encontrado. Crie um com idioma e verbos permitidos."
  exit 1
fi

# L√™ idioma e verbos do arquivo
LANG=$(head -n1 "$LANG_FILE")
VERBOS=$(tail -n +2 "$LANG_FILE")

# Extrai o primeiro verbo ap√≥s os dois-pontos
INICIO=$(echo "$RAW_MSG" | cut -d':' -f2 | awk '{print $1}' | tr '[:upper:]' '[:lower:]')

# Verifica se est√° entre os verbos permitidos
echo "$VERBOS" | tr ' ' '\n' | grep -woq "$INICIO"

if [ $? -ne 0 ]; then
  echo "‚ùå O commit precisa come√ßar com um verbo permitido para '$LANG'."
  echo "üîπ Verbo usado: '$INICIO'"
  echo "‚úÖ Verbos v√°lidos: $VERBOS"
  exit 1
fi

exit 0